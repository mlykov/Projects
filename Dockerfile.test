FROM golang:1.22-bookworm

# Install required tools for tests
RUN apt-get update && apt-get install -y \
    coreutils \
    pciutils \
    procps \
    sudo \
    e2fsprogs \
    util-linux \
    lvm2 \
    && rm -rf /var/lib/apt/lists/*

# Configure sudo to work without password for go user (needed for integration tests)
RUN echo "go ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

WORKDIR /app

# This Dockerfile is used for running tests
# Mount your code with: docker run --rm --privileged --cap-add=SYS_ADMIN --cap-add=MKNOD \
#   -v $(PWD):/app -w /app <image> go test -json ./...
